<!––FOR EXTENSION INFO, LOOK ALL THE WAY AT THE BOTTOM––>
<!--Transmitter V3.00-->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <link rel="stylesheet" id="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/eggplant/jquery-ui.css" onerror="this.onerror=null;this.href='https:\/\/code.jquery.com/ui/1.11.4/themes/eggplant/jquery-ui.css'" >
        <title>TLS hub for LioranBoard</title>
    </head>
	<style> 
body{font-family:Arial}.ui-widget{font-size:90%;font-family:Arial}h1{padding-left:10px;font-family:"Palatino Linotype"}.connected{color:#4ad84a}.disconnected{color:#fb4848}.TLSConnection{border:5px #fff}table{padding-left:10px}td,tr{border:0 solid #ddd;padding:2px}.tabsEnabled{color:#fff;background-color:#1f1e1f}.ui-tabs{size:5px}button{padding:2px 5px;margin:4px 0;box-shadow:2 2px #c5c5c5}button:active{background-color:#797979;color:#fff;box-shadow:0 0 rgb(223, 223, 223);transform:translateY(1px)}.tabsDisabled{color:#fff;background-color:#1f1e1f;padding:10px}.tabsDisabled button{color:#fff;background-color:#4c4c4c;border-color:#464546}.tabsDisabled input{color:#fff;background-color:#4c4c4c}.TLSConnection{padding:10px}input{padding:0px;margin:1px 1px}
    </style>
    
    <body id="body" class="tabsEnabled">
			
			<p id="nothing"><h1>Lioranboard TLS hub</h1></p>
			<div class="TLSConnection">
			<span>LioranBoard: </span><span id="toclient" class="disconnected">Not connected.</span>
			<span> Pubsub: </span><span class="disconnected" id="topubsub">Not connected.</span>
			<span> Chat: </span><span class="disconnected" id="tochat">Not connected.</span></div>
			<div id="tabs"><ul id="tab_list"></ul>
			<div id="tabs-basic" class="tab" title="Pubsub Alerts">
			<button type="button" onclick="fakesub2()">Test Sub</button>
			<span style="cursor: pointer;" id="hidesubs_button" onclick="hideTSLUI('hidesubs')">Show Options &#129095;</span>
			<span id="hidesubs" style="display:none"> <br>
			<input type="radio" id="itier1" name="tier" value="vtier1" checked>
			Tier 1
			<input type="radio" id="itier2" name="tier" value="vtier2">
			Tier 2
			<input type="radio" id="itier3" name="tier" value="vtier3" >
			Tier 3
			<input type="radio" id="iprime" name="tier" value="vprime" onclick="primefunction()" >
			Prime <br>
			<input type="checkbox" id="isubgift" name="subgift" value="vsubgift" onclick="subgiftfunction()">
			SubGift
			<input type="checkbox" id="ianongift" name="subgift" value="vanongift" onclick="anongiftfunction()">
			AnonGift 
			<input type="number" min="0" max="100" id="nsubmonths" name="nsubmonths" style="margin:5px 0px"> Months <br>
			Message:	
			<input type="text" id="nsubmessage" name="nsubmessage" size="20" style="margin:5px 0px;"></span>
			<br>
			<button type="button" onclick="fakegiftamount()">Test Subs Gift Amount</button>
			Amount:
			<input type="number" min="0" max="1000" id="igiftamount" name="ngiftamount">
			<br/>
			<button type="button" onclick="fakebits()">Test Bits</button>
			<span style="cursor: pointer;" id="hidebits_button" onclick="hideTSLUI('hidebits')">Show Options &#129095;</span>
			<span id="hidebits" style="display:none"> 
			<br>
			Amount of bits:
			<input type="number" min="0" max="100000" id="ibitsamount" name="nbitsamount">
			Total bits: 	
			<input type="number" min="0" max="500000" id="ibitstotal" name="ibitstotal"><br/>
			Message:	
			<input type="text" id="ibitsmessage" name="ibitsmessage" size="20" style="margin:5px 0px;"></span>
			<br>
			<button type="button" onclick="fakepoints()">Test Channel Points</button>
			<span style="cursor: pointer;" id="hidepoints_button" onclick="hideTSLUI('hidepoints')">Show Options &#129095;</span>
			<span id="hidepoints" style="display:none"> <br> 
			Redeem Name:
			<input type="text" id="ichannelpoints" name="nchannelpoints" size="10" style="margin:5px 0px">	<input type="checkbox" id="nchannelpointinput" name="nchannelpointinput" > User Input Required <br>
			Redeem Message:	
			<input type="text" id="nchannelpointsmsg" name="nchannelpointsmsg" size="20"  >	</span>
			<br>
			<button type="button" onclick="fakeraid()">Test Raid</button>
			Amount:
			<input type="number" min="0" max="100000" id="iraidamount" name="nraidamount">
			<br>
			<button type="button" onclick="fakehost()">Test Host</button>
			Amount:
			<input type="number" min="0" max="100000" id="ihostamount" name="nhostamount">
			<br>
			<button type="button" onclick="fakechatmsg()">Test Chat Message </button> 	
			<span style="cursor: pointer;" id="hidechatmsg_button" onclick="hideTSLUI('hidechatmsg')">Show Options &#129095;</span>
			<span id="hidechatmsg" style="display:none"> <br> 
			Username: <input type="text" id="ichatname" size="10"> <br> Message: <input type="text" id="ichatmsg" size="20" style="margin:5px 0px";>	<br>
			<input type="checkbox" id="ichatbroadcaster"> Broadcaster <input type="checkbox" id="ichatmod"> Mod <input type="checkbox" id="ichatsub"> Subscriber <input type="checkbox" id="ichatvip"> VIP
            </div>

            <div id="tabs-themes" class="tab" title="Themes">
                
                <button id="changestyle" onclick="DisableTabs()">Classic</button> <button id="changestyle" onclick="EnableTabs()">Tabs</button>  <br>
                <span id="TSL-show-themes">
                <button id="changestyle" onclick="ChangeStyle('ui-lightness')"> Lightness</button> 
				<button id="changestyle" onclick="ChangeStyle('ui-darkness')"> Darkness</button> <button id="changestyle" onclick="ChangeStyle('smoothness')"> Smoothness</button> 
				<button id="changestyle" onclick="ChangeStyle('start')"> Start</button> <button id="changestyle" onclick="ChangeStyle('redmond')"> Redmond</button> 
				<button id="changestyle" onclick="ChangeStyle('sunny')"> Sunny</button> <button id="changestyle" onclick="ChangeStyle('overcast')"> Overcast</button> 
				<button id="changestyle" onclick="ChangeStyle('le-frog')"> Le Frog</button> <button id="changestyle" onclick="ChangeStyle('flick')"> Flick</button> 
				<button id="changestyle" onclick="ChangeStyle('pepper-grinder')"> Pepper Grinder</button><br> <button id="changestyle" onclick="ChangeStyle('eggplant')"> Eggplant</button> 
				<button id="changestyle" onclick="ChangeStyle('dark-hive')"> Dark Hive</button> <button id="changestyle" onclick="ChangeStyle('cupertino')"> Cupertino</button>   
				<button id="changestyle" onclick="ChangeStyle('south-street')"> South Street</button> <button id="changestyle" onclick="ChangeStyle('blitzer')"> Blitzer</button> 
				<button id="changestyle" onclick="ChangeStyle('humanity')"> Humanity</button> 
				<button id="changestyle" onclick="ChangeStyle('excite-bike')"> Excite Bike</button> <button id="changestyle" onclick="ChangeStyle('vader')"> Vader</button> 
				<button id="changestyle" onclick="ChangeStyle('dot-luv')"> Dot Luv</button> <br><button id="changestyle" onclick="ChangeStyle('mint-choc')"> Mint Choc</button> 
				<button id="changestyle" onclick="ChangeStyle('black-tie')"> Black Tie</button> <button id="changestyle" onclick="ChangeStyle('trontastic')"> Trontastic</button> 
                <button id="changestyle" onclick="ChangeStyle('swanky-purse')"> Swanky Purse</button> <br><br></span>
                </div>

                
<!--Your external script will be inserted here-->
<!--<script src="example.js"></script>-->
<!--INSERT PART 1-->
<!--Change Twitch Status external-->
<div id='orientation'></div>
<div id="tabs-Change_Twitch_Status" class="tab" title="Change Twitch Status">
<div><p>Twitch Status change extension installed</div></p>
</div>
<!--Change Twitch Status external end-->
<!--Viewer Count external-->
<div id="tabs-Viewer_Count" class="tab" title="Viewer Count">
<div><p>Get viewer count extension is installed</div></p>
</div>
<!--Viewer Count external end-->
<!--Subscriber Count external-->
<div id="tabs-Subscriber_Count" class="tab" title="Subscriber Count">
<div><p>Get subscriber count extension is installed</div></p>
</div>
<!--Subscriber Count external end-->
<!--Get Channel ID external-->
<div id="tabs-Get_Channel_ID" class="tab" title="Get Channel ID">
<div><p>Get Channel ID extension is installed</div></p>
</div>
<!--Get Channel ID external end-->
<!--Follower Alert external-->
<div id="tabs-Follower_Alert" class="tab" title="Follower Alert">
<div>Follower Alert extension installed.</div><br>
<button type="button" onclick="fakefollow()">Test Follower Trigger</button>
</div>
<!--Follower Alert external end-->
<!--Bits Leaderboard external-->
<div id="tabs-Bits_Leaderboard" class="tab" title="Bits Leaderboard">
<div><p>Bits Leaderboard extension installed.</div></p>
</div>
<!--Bits Leaderboard external end-->
</div><br>
<div id="footer"><table><tr><td>Installed extensions:  <span id="installedextensions"></td></tr>
<tr><td><button id="extensionsreset">Reset Tabs Visibility</button> <button id="extensionsresetorder">Reset Tabs Order</button> <button onclick="location.reload()">Reload Transmitter</button></td></tr>
</table></div>
<script>

//retrieve last used theme and set it up

window.addEventListener('deviceorientation', function (evt) {
const test = document.getElementById('orientation');
test.innerHTML = `${evt.absolute} + ${evt.alpha} + ${evt.beta} + ${evt.gamma}`
console.log(evt)
});

$(function() {
const type=localStorage.getItem('TSLTabs') || "tabs"
if (type!="notabs"){   //checked whether user enabled or disabled tabs
EnableTabs ()    
const name=localStorage.getItem('TSLCSS') || "eggplant"
ChangeStyle(name)
}
else {DisableTabs ()}
}
)

function hideTSLUI(id) 
{
    let e = document.getElementById(id);
	let text = document.getElementById(id+"_button")
    if (e.style.display == 'inline'){
        e.style.display = 'none'
		text.innerHTML = 'Show Options &#129095';}
    else{
        e.style.display = 'inline';
		text.innerHTML = 'Hide Options &#129093';
	}
}

//retrieve extension visiblity configuration
function SelectExtensions (){
let ext_checked = JSON.parse(localStorage.getItem('ext_checked')) || {}
let list = document.querySelector("#installedextensions")
let extensions = document.querySelectorAll('*[id^="tabs-"]')
for (let i=2;i<extensions.length;i++){
let checkbox = document.createElement('input')	
let text = document.createElement('span')
text.innerHTML = extensions[i].title+"  "
checkbox.type= 'checkbox';
checkbox.id = 'checkbox'+extensions[i].id;
checkbox.checked = ((ext_checked[checkbox.id])!=undefined) ? ext_checked[checkbox.id] : true
let id = extensions[i].id
let li = document.querySelector('[aria-controls="'+id+'"]')
if (checkbox.checked){
$( li ).closest( "li" ).show().attr( "aria-controls" )}
else {
$( li ).closest( "li" ).hide().attr( "aria-controls" )
}
text.prepend(checkbox)
list.appendChild(text)
}}

//hide or show extension in a tab
document.querySelector('#installedextensions').onclick = function(ev) {
if(ev.target.value) {
let id = ev.target.id.slice(8)
let li = document.querySelector('[aria-controls="'+id+'"]');
if (ev.target.checked){
$( li ).closest( "li" ).show().attr( "aria-controls" )}
else {
$( li ).closest( "li" ).hide().attr( "aria-controls" )
}
  }
}

//reset tabs order
document.querySelector('#extensionsresetorder').onclick = function(ev) {
localStorage.removeItem('tab_order')
location.reload()
}

//reset tabs visibility
document.querySelector('#extensionsreset').onclick = function(ev) {
localStorage.removeItem('ext_checked')
location.reload()
}

//save tab visiblity configuration
function SaveVisibility() {
  let ext_checked = JSON.parse(localStorage.getItem('ext_checked')) || {}
  $("#installedextensions input[type=checkbox]").each(function () {
    ext_checked[this.id] = this.checked
  });
  localStorage.setItem('ext_checked', JSON.stringify(ext_checked))
}

document.querySelector('#installedextensions').onclick = function (ev) {
  if (ev.target.value) {
    let id = ev.target.id.slice(8)
    let li = document.querySelector('[aria-controls="' + id + '"]');
    if (ev.target.checked) {
      $(li).closest("li").show().attr("aria-controls")
    } else {
      $(li).closest("li").hide().attr("aria-controls")
    }
    SaveVisibility()
  }
}

//change the theme
function ChangeStyle(name){
document.getElementById('stylesheet').href='https://code.jquery.com/ui/1.11.4/themes/'+name+'/jquery-ui.css';
localStorage.setItem('TSLCSS',name)  
}

//enable tabs and create them
function EnableTabs (){
document.getElementById('body').className = "tabsEnabled";
document.getElementById("TSL-show-themes").style.display="block"
document.getElementById("footer").style.display="block"
localStorage.setItem('TSLTabs','tabs')
if (document.querySelectorAll("#tab_list li").length==0){
try {   //try to create tabs 
    $('.tab').each(function(i, obj) {
        $('#tab_list').append('<li><a href="#'+this.id+'">'+this.title+'</a></li>');
});
      $( "#tabs" ).tabs({create: SelectExtensions})
      $(function($) {
       let order = JSON.parse(localStorage.getItem('tab_order')) || []
       $.each(order.reverse(), function(i, v) {
    $('li[aria-controls="' + v + '"]').prependTo('ul');
})
    $("#tab_list").sortable({
            
        update: function(e, ui) {
            let ID = []; 
            let select = document.querySelector("#tab_list").children;
            for (let i=0;i<select.length;i++){
             ID.push(select[i].attributes['aria-controls'].value); 
             }
            localStorage.setItem('tab_order',JSON.stringify(ID)) // save new order
        }
    })
   
});  
    }
catch (e){}}
}

//switch to classic mode and remove tabs
function DisableTabs (){  
localStorage.setItem('TSLTabs','notabs')
document.getElementById('body').className = "tabsDisabled";
document.getElementById("TSL-show-themes").style.display="none"
document.getElementById("footer").style.display="none"
document.getElementById("tab_list").innerHTML=""
document.getElementById('installedextensions').innerHTML=""
try{
$( "#tabs" ).tabs( "destroy" );}
catch(e){}
}


//url for lioranboard
var url = "ws://127.0.0.1:9423";
//if you make an extension and it connects to twitch, use this id
var TWITCH_CLIENT_ID = "tpqy40pm79e00s63cqusqepvhwqz1n";
//value that says if pubsub is connected or not
var on_server = 0;
var on_chat = 0;
var i_force="";
var twitchreconnecting=0;
var twitchpingid=0;
var just_raided=[];
itier1.checked=true;
igiftamount.value=1;
ibitsamount.value=1;
iraidamount.value=1;
ihostamount.value=1;
//check box code
function primefunction(){if (iprime.checked==true){isubgift.checked=false;ianongift.checked=false}}
function subgiftfunction(){if (iprime.checked==true){iprime.checked=false;itier1.checked=true}ianongift.checked=false}
function anongiftfunction(){if (iprime.checked==true){iprime.checked=false;itier1.checked=true}isubgift.checked=false}

//fake trigger testing
function fakesub(){var i_name=fakename();
	if (i_force!=""){i_name=i_force}
	var i_name2=fakename();
	var i_value="1000"; if (itier2.checked==true){i_value="2000"}; if (itier3.checked==true){i_value="3000"}; if (iprime.checked==true){i_value="Prime"}; i_context="resub"; if (isubgift.checked==true){i_context="subgift"}; if (ianongift.checked==true){i_context="anonsubgift"}
	let messages = ["Hello world!","Love your stream, you are a very genuine guy and you're not affraid to say it how it is. But, I would just prefer if you didn't give your opinion, just saying.","Supporting how I can, keep up the great work.","All that glitters is not gold. Fair is foul, and foul is fair Hover through the fog and filthy air. These violent delights have violent ends. Hell is empty and all the devils are here. By the pricking of my thumbs, Something wicked this way comes. Open, locks, Whoever knocks!"]
	var i_message=nsubmessage.value || messages [Math.floor(Math.random()*messages.length)]
	let months = nsubmonths.value || Math.ceil(Math.random()*10)
	let context = (months>1)? "resub" : "sub" 
	if (i_context=="resub"){i_str='{"type": "MESSAGE","data": {"topic": "channel-subscribe-events-v1.44322889","message": "{\\"user_name\\": \\"'+i_name.toLowerCase()+'\\",\\"display_name\\": \\"'+i_name+'\\",\\"channel_name\\": \\"twitch\\",\\"user_id\\": \\"44322889\\",\\"channel_id\\": \\"12826\\",\\"time\\": \\"2015-12-19T16:39:57-08:00\\",\\"sub_plan\\": \\"'+i_value+'\\",\\"sub_plan_name\\": \\"Channel Subscription (mr_woodchuck)\\",\\"cumulative_months\\": '+months+',\\"streak_months\\": 1,\\"context\\": \\"'+context+'\\",\\"sub_message\\": {\\"message\\": \\"'+i_message+'\\",\\"emotes\\": [{\\"start\\": 23,\\"end\\": 7,\\"id\\": 2867}]}}"}}'}
	if (i_context=="subgift"){i_str='{"type": "MESSAGE","data": {"topic": "channel-subscribe-events-v1.44322889","message": "{\\"user_name\\": \\"'+i_name.toLowerCase()+'\\",\\"display_name\\": \\"'+i_name+'\\",\\"channel_name\\": \\"twitch\\",\\"user_id\\": \\"44322889\\",\\"channel_id\\": \\"12826\\",\\"time\\": \\"2015-12-19T16:39:57-08:00\\",\\"sub_plan\\": \\"'+i_value+'\\",\\"sub_plan_name\\": \\"Channel Subscription (mr_woodchuck)\\",\\"months\\": '+months+',\\"context\\": \\"subgift\\",\\"sub_message\\": {\\"message\\": \\"'+i_message+'\\",\\"emotes\\": null },\\"recipient_id\\": \\"13405587\\",\\"recipient_user_name\\": \\"'+i_name2.toLowerCase()+'\\",\\"recipient_display_name\\": \\"'+i_name2+'\\"}}"}}'}
	if (i_context=="anonsubgift"){i_str='{"type": "MESSAGE","data": {"topic": "channel-subscribe-events-v1.44322889","message": "{\\"channel_name\\": \\"twitch\\",\\"channel_id\\": \\"12826\\",\\"time\\": \\"2015-12-19T16:39:57-08:00\\",\\"sub_plan\\": \\"'+i_value+'\\",\\"sub_plan_name\\": \\"Channel Subscription (mr_woodchuck)\\",\\"months\\": '+months+',\\"context\\": \\"anonsubgift\\",\\"sub_message\\": {\\"message\\": \\"'+i_message+'\\",\\"emotes\\": null },\\"recipient_id\\": \\"13405587\\",\\"recipient_user_name\\": \\"'+i_name2.toLowerCase()+'\\",\\"recipient_display_name\\": \\"'+i_name2+'\\"}"}}'}
	console.log("Fake Test Sub sent."); lioranboardclient.send(i_str);
}
function fakebits(){var i_name=fakename();
	if (ibitsamount.value<1){ibitsamount.value=1;};
	let message = ibitsmessage.value.replace(/"/g,"'") || 'Enjoy the non-existant bits, Even if, only for a short time you got the dopamine of seeing a bits notification. Have a good day.'	
	let total = ibitstotal.value || Math.ceil(Math.random()*5000)
	i_value=parseFloat(ibitsamount.value); if (isNaN(i_value)==true){i_value=1}; if (i_value<=0){i_value=1};
	i_str='{"type": "MESSAGE","data": {"topic": "channel-bits-events-v2.46024993","message": "{\\"data\\":{\\"user_name\\":\\"'+i_name.toLowerCase()+'\\",\\"channel_name\\":\\"twitch\\",\\"user_id\\":\\"95546976\\",\\"channel_id\\":\\"46024993\\",\\"time\\":\\"2017-02-09T13:23:58.168Z\\",\\"chat_message\\":\\"'+message+'\\",\\"bits_used\\":'+i_value+',\\"total_bits_used\\":'+total+',\\"context\\":\\"cheer\\",\\"badge_entitlement\\":{\\"new_version\\":25000,\\"previous_version\\":10000}},\\"version\\":\\"1.0\\",\\"message_type\\":\\"bits_event\\",\\"message_id\\":\\"8145728a4-35f0-4cf7-9dc0-f2ef24de1eb6\\",\\"is_anonymous\\":true}"}}'
	console.log("Fake Test bits for "+i_value); lioranboardclient.send(i_str);
}
function fakepoints(){var i_name=fakename();
	let message = nchannelpointsmsg.value.replace(/"/g,"'") || 'Testing Message'
	i_str='{"type":"MESSAGE","data":{"topic":"channel-points-channel-v1.23071698","message":"{\\"type\\":\\"reward-redeemed\\",\\"data\\":{\\"timestamp\\":\\"2020-05-10T02:42:01.699693419Z\\",\\"redemption\\":{\\"id\\":\\"f2418f14-1e2b-41f3-90e5-fcad7ab2c701\\",\\"user\\":{\\"id\\":\\"23071698\\",\\"login\\":\\"'+i_name.toLowerCase()+'\\",\\"display_name\\":\\"'+i_name+'\\"},\\"channel_id\\":\\"23071698\\",\\"redeemed_at\\":\\"2020-05-10T02:42:01.674616194Z\\",\\"reward\\":{\\"id\\":\\"46b39721-ce2b-4670-8b2d-b520762a3f1e\\",\\"channel_id\\":\\"23071698\\",\\"title\\":\\"'+ichannelpoints.value+'\\",\\"prompt\\":\\"Testing Message\\",\\"cost\\":1,\\"is_user_input_required\\":'+nchannelpointinput.checked+',\\"is_sub_only\\":false,\\"image\\":{\\"url_1x\\":\\"https://static-cdn.jtvnw.net/custom-reward-images/23071698/46b39721-ce2b-4670-8b2d-b520762a3f1e/d50acf1d-4a0c-4dd0-8596-e5ca0c386332/custom-1.png\\",\\"url_2x\\":\\"https://static-cdn.jtvnw.net/custom-reward-images/23071698/46b39721-ce2b-4670-8b2d-b520762a3f1e/d50acf1d-4a0c-4dd0-8596-e5ca0c386332/custom-2.png\\",\\"url_4x\\":\\"https://static-cdn.jtvnw.net/custom-reward-images/23071698/46b39721-ce2b-4670-8b2d-b520762a3f1e/d50acf1d-4a0c-4dd0-8596-e5ca0c386332/custom-4.png\\"},\\"default_image\\":{\\"url_1x\\":\\"https://static-cdn.jtvnw.net/custom-reward-images/default-1.png\\",\\"url_2x\\":\\"https://static-cdn.jtvnw.net/custom-reward-images/default-2.png\\",\\"url_4x\\":\\"https://static-cdn.jtvnw.net/custom-reward-images/default-4.png\\"},\\"background_color\\":\\"#00C7AC\\",\\"is_enabled\\":true,\\"is_paused\\":false,\\"is_in_stock\\":true,\\"max_per_stream\\":{\\"is_enabled\\":false,\\"max_per_stream\\":100},\\"should_redemptions_skip_request_queue\\":true,\\"template_id\\":null,\\"updated_for_indicator_at\\":\\"2020-02-12T18:00:03.401562134Z\\"},\\"user_input\\":\\"'+message+'\\",\\"status\\":\\"FULFILLED\\"}}}"}}'
	console.log('Fake Test Channel Points Redeem "'+ichannelpoints.value+'" sent.'); lioranboardclient.send(i_str);
}

function fakesub2(){
	if (i_force==""){fakesub();}
}

function forcenameoff(){
	i_force="";
}

function fakegiftamount(){
	if (i_force!==""){return 0;}
	i_force=fakename();
	if (igiftamount.value<1){igiftamount.value=1;};
	if (igiftamount.value>100){igiftamount.value=100;};
	if (iprime.checked==true){iprime.checked=false; itier1.checked=true};
	if (ianongift.checked==false){isubgift.checked=true}else{i_force="Anonymous User"};
	var i_value="Tier 1"; if (itier2.checked==true){i_value="Tier 2"}; if (itier3.checked==true){i_value="Tier 3"};
	console.log("Fake sub gift amount of "+igiftamount.value+" sent."); lioranboardclient.send('{"type":"MESSAGE","topic":"FakeNotification","fake":0,"amount":"'+igiftamount.value+'","name":"'+i_force+'","tier":"'+i_value+'"}');
	for (var ii=0;ii<igiftamount.value;ii++){
		setTimeout(fakesub,1000+ii*10);
	}
	setTimeout(forcenameoff,2100);
}
function fakeraid(){if (iraidamount.value<1){iraidamount.value=1;}; console.log("Fake Raid of "+iraidamount.value+" sent."); lioranboardclient.send('{"type":"MESSAGE","topic":"FakeNotification","fake":1,"amount":"'+iraidamount.value+'","name":"'+fakename()+'"}');}
function fakehost(){if (ihostamount.value<1){ihostamount.value=1;}; console.log("Fake Host of "+ihostamount.value+" sent."); lioranboardclient.send('{"type":"MESSAGE","topic":"FakeNotification","fake":2,"amount":"'+ihostamount.value+'","name":"'+fakename()+'"}');}
function fakename(){
 let names = ["Lioran","nutella4eva","Kottpower","Neverwho","Deomew","Doodybeard","Exeldro","AuralMoral","SuperMetroid","Melonax","Ptoil","LinksDarkHalf","Derpiii_","CoD360_420","Bill","Kurocha","Lisa","DeathByButtonMash","Daryl"]
 let random_name = names[Math.floor(Math.random()*names.length)]
 return random_name
}

function fakechatmsg(){	
	let name = ichatname.value || fakename()	
	let msg = ichatmsg.value.replace(/"/g,"'") || 'This is a test message.'	 
	let badge = []	
	if (ichatbroadcaster.checked){badge.push('broadcaster/1')}	
	if (ichatmod.checked){badge.push('moderator/1')}	
	if (ichatsub.checked){badge.push('subscriber/1')}	
	if (ichatvip.checked){badge.push('vip/1')}	
	let chat_obj = '{"emotes":"304822798:0-9/304682444:11-19","login":"'+name.toLowerCase()+'","display_name":"'+name+'","color":"#189A8D","badge":"'+badge.join()+'","message":"'+msg+'","channel":"'+name+'","topic":"chatmessage","type":"MESSAGE"}'	
	lioranboardclient.send(chat_obj)	
}

function ConnectionStatus (id, status,text){
document.getElementById(id).className = status;
document.getElementById(id).innerHTML = text
}

//main connection to LioranBoard Stream Deck
function connecttoboard()
{	
	lioranboardclient = (new WebSocket(url));
	lioranboardclient.binaryType = "arraybuffer";
	//reconnect on disconnect
	lioranboardclient.onclose = function(event) {
		ConnectionStatus ("toclient", "disconnected", "Disconnected, attempting to reconnect.")
	  if (on_server==1){
		  on_server=0;
		  clearTimeout(twitchreconnecting)
		  TwitchChatConnect.close();
		  pubsubserver.close();
		  
	  }
	  connecttoboard();
	};
	//notice that connection is established
	lioranboardclient.onopen = function(event) {
		ConnectionStatus ("toclient", "connected", "Connected.")
	  //You LioranBoard extension command will be inserted here
	  /*INSERT PART 2*/
//[Change Twitch Status command]
//change title or game command for lioranboard
lioranboardclient.send('{"type":"MESSAGE","topic":"ExtensionCommand","name":"Change Stream","boxcount":4,"boxname1":"oauth_token","boxtype1":"string","boxname2":"channel_id","boxtype2":"real","boxname3":"title","boxtype3":"string","boxname4":"game","boxtype4":"string"}');

//[Change Twitch Status command end]
//[Viewer Count command]
lioranboardclient.send('{"type":"MESSAGE","topic":"ExtensionCommand","name":"Get Viewer Count","boxcount":2,"boxname1":"channel_id","boxtype1":"string","boxname2":"value_name","boxtype2":"string"}');

//[Viewer Count command end]
//[Subscriber Count command]
//bits leaderboard command
lioranboardclient.send('{"type":"MESSAGE","topic":"ExtensionCommand","name":"Get Subscriber Count","boxcount":3,"boxname1":"oauth_token","boxtype1":"string","boxname2":"channel_id","boxtype2":"string","boxname3":"value_name","boxtype3":"string"}');

//[Subscriber Count command end]
//[Get Channel ID command]
lioranboardclient.send('{"type":"MESSAGE","topic":"ExtensionCommand","name":"Get Channel Id","boxcount":3,"boxname1":"oauth_token","boxtype1":"string","boxname2":"name","boxtype2":"string","boxname3":"Variable","boxtype3":"string"}');
//[Get Channel ID command end]
//[Follower Alert command]
//follower alert command
lioranboardclient.send('{"type":"MESSAGE","topic":"ExtensionCommand","name":"Follower Alert","boxcount":1,"boxname1":"channel_id","boxtype1":"real"}');

//[Follower Alert command end]
//[Bits Leaderboard command]
//bits leaderboard command
lioranboardclient.send('{"type":"MESSAGE","topic":"ExtensionCommand","name":"Check Leaderboard","boxcount":1,"boxname1":"oauth_token","boxtype1":"string"}');

//[Bits Leaderboard command end]


	};
	//receiving a message
	lioranboardclient.onmessage = function(event){
		boardmessage();
	};
};
//init that function right away
connecttoboard()
//receiving a message from lioranboard
function boardmessage(){
		//console.log("LioranBoard message received.")
		if (typeof(event.data) == "string"){
			str=event.data
			val=str.slice(0,1);
			str=str.slice(2,str.length);
			switch (val){
				//connect to pubsub now
				case "0":{
					
					document.getElementById("topubsub").innerHTML = "Connection request to PubSub."
					serverurl=str//not used
					on_server=1;
					connectserver();
					connecttwitchchat();
					twitch_timeout=4000;
				}break;
				//transmitting LioranBoard message to pubsub
				case "1":{
					pubsubserver.send(str);
				}break;
				//send api request
				case "2":{
					api_request=str
					apiconnect();
				}break
				//JSON string from LioranBoard
				case "3":{
					LioranBoardJSON = JSON.parse(str);
					LBExtensionReceived();
				}break
				//reload transmitter
				case "4":{
					location.reload();
				}break
				//send stuff to twitch chat
				case "5":{
					TwitchChatConnect.send(str);
				}break
			}
		}else{
			console.log("Message received from LioranBoard is not a string.")
		}
}

//connect to twitch pubsub
function connectserver(){
	
	pubsubserver = (new WebSocket("wss://pubsub-edge.twitch.tv"));
	//attempt to reconnect on disconnect, unless LioranBoard is disconnected
	pubsubserver.onclose = function(event) {
		console.log("Disonnected")
	  if (on_server==1){
		connectserver();
		ConnectionStatus ("topubsub", "disconnected", "Connection closed. Attempting to reconnect.")
		var i_obj={};
		i_obj.topic="pubsubdisconnected"
		i_obj.type="MESSAGE"
		lioranboardclient.send(JSON.stringify(i_obj));
		//lioranboardclient.send("pubsubdisconnected");
	  }else{
		ConnectionStatus ("topubsub", "disconnected", "Connection closed.")
	  }
	};
	//notify lioranboard that pubsub connection is establishd successfully
	pubsubserver.onopen = function(event) {
		ConnectionStatus ("topubsub", "connected", "Connected.")
		var i_obj={};
		i_obj.topic="pubsubconnected"
		i_obj.type="MESSAGE"
		lioranboardclient.send(JSON.stringify(i_obj));
		console.log("Connected to PubSub")
		//lioranboardclient.send("pubsubconnected");
	};
	//receive data from pubsub, so send it to LioranBoard
	pubsubserver.onmessage = function(event){
		servermessage();
	};
	
}

function twitchchatping(){
	TwitchChatConnect.send("PONG :tmi.twitch.tv");
}
function clear_raiders(){
	just_raided.shift();
}
//twitch chat connection
function connecttwitchchat(){
	if (on_server==0){return 0}
	TwitchChatConnect = (new WebSocket("wss://irc-ws.chat.twitch.tv:443"));
	TwitchChatConnect.binaryType = "arraybuffer";
	TwitchChatConnect.onopen = function(event) {
		ConnectionStatus ("tochat","connected","Connected.")
		//lioranboardclient.send("twitchchatconnected");
		console.log("Connected to twitch chat")
		var i_obj={};
		i_obj.topic="twitchchatconnected"
		i_obj.type="MESSAGE"
		lioranboardclient.send(JSON.stringify(i_obj));
		twitchpingid = setInterval(twitchchatping,120000);
		twitch_timeout=4000;
	};
	TwitchChatConnect.onmessage = function(event){
		var i_str;
		var i_whole;
		i_whole=event.data;
		console.log("["+i_whole+"]");
		var i_count = (i_whole.match(/\r\n/g) || []).length;
		
		var i;
		var ii;
		for (i = 0; i < i_count; i++) {
			var i_pos;
			
			i_pos=i_whole.indexOf("\r\n");
			i_str=" "+i_whole.slice(0,i_pos);
			i_whole=i_whole.slice(i_pos+2)
			//ping back
			if (i_str.slice(0,5)==" PING"){
				TwitchChatConnect.send("PONG :tmi.twitch.tv");
			}else{
				var i_type;
				var i_real_name;
				
				var i_data;
				var i_name;
				var i_emote;
				var i_color;
				var i_badge;
				var i_badge_count;
				var i_channel;

				//seperate data
				i_pos=i_str.indexOf(" :")+1;
				i_data=i_str.slice(0,i_pos);
				i_str=i_str.slice(i_pos+1);
				
				//get type of data
				i_pos=i_str.indexOf(":");
				i_type=i_str.slice(0,i_pos);
				i_str=i_str.slice(i_pos+1);
				i_real_name=i_type;
				i_pos=i_type.indexOf(" ");
				i_type=i_type.slice(i_pos+1);
				i_pos=i_type.indexOf(" ");
				


				if (i_pos!=-1){
					i_channel=i_type.slice(i_type.indexOf(" ")+1)
					i_channel=i_channel.replace(" ","");
					i_channel=i_channel.replace("#","");
					i_type=i_type.slice(0,i_pos);
				}
				switch (i_type){
					//connected
					case "001":{
						var i_obj={};
						i_obj.topic="ChatConnected"
						i_obj.type="MESSAGE"
						lioranboardclient.send(JSON.stringify(i_obj));
					}break
					//disconnected
					case "NOTICE":{

					}break
					case "USERNOTICE":{
						i_type=IRCdataparse(i_data,"msg-id");
						//raid
						if (i_type=="raid"){
							var i_amount=IRCdataparse(i_data,"viewerCount");
							if (i_amount==""){i_amount="1";}
							i_name=IRCdataparse(i_data,"msg-param-displayName");
							i_real_name=IRCdataparse(i_data,"login");
							//make sure the raider didn't just raid
							if (just_raided.some(item => item === i_name)==false){
								just_raided.push(i_name);
								setTimeout(clear_raiders,5000);
								//send raid to the receiver
								var i_obj={};
								i_obj.topic="raidmessage";
								i_obj.type="MESSAGE";
								i_obj.login=i_real_name;
								i_obj.name=i_name;
								i_obj.amount=i_amount;
								lioranboardclient.send(JSON.stringify(i_obj));
							}
						}
						//subgift
						if (i_type=="submysterygift"){
							var i_amount=IRCdataparse(i_data,"msg-param-mass-gift-count");
							if (i_amount==""){i_amount="1"}
							i_name=IRCdataparse(i_data,"display-name");
							i_real_name=IRCdataparse(i_data,"login");
							i_userid=IRCdataparse(i_data,"user-id");
							var i_plan=IRCdataparse(i_data,"msg-param-sub-plan");
							if (i_plan=="2000"){
								i_plan="Tier 2"
							}else{
								if (i_plan=="3000"){
									i_plan="Tier 3"
								}else{
									i_plan="Tier 1"
								}
							}
							if ((i_userid=="") || (i_userid=="274598607")){
								i_real_name="Anonymous User";
								i_name="Anonymous User";
							}
							//send gift sub to the receiver
							var i_obj={};

							i_obj.topic="giftsubmessage";
							i_obj.type="MESSAGE";
							i_obj.login=i_real_name;
							i_obj.name=i_name;
							i_obj.amount=i_amount;
							i_obj.plan=i_plan;
							lioranboardclient.send(JSON.stringify(i_obj));
						}
						
					}break
					case "PRIVMSG":{
						//get message id
						//var i_id;
						//i_id=IRCdataparse(i_data,"id");
						
						//get display name
						i_name=IRCdataparse(i_data,"display-name");
						//get Emote
						i_emote=IRCdataparse(i_data,"emotes");
						//get color
						i_color=IRCdataparse(i_data,"color");
						
			
						//get user name
						i_pos=i_real_name.indexOf("!");
						i_real_name=i_real_name.slice(0,i_pos);
						
						//badges
						i_badge=IRCdataparse(i_data,"badges");
						if (i_real_name=="jtv"){
							

							i_pos=i_str.indexOf("hosting")

							i_name=i_str.slice(0,i_str.indexOf(" "))
							if (just_raided.some(item => item === i_name)==false){
								setTimeout(clear_raiders,5000);
								just_raided.push(i_name);
								i_amount=i_str.slice(i_pos)
								i_amount=i_amount.replace(/\D/g, "")
								if (i_amount==""){i_amount="0"}
								//send host to the receiver
								var i_obj={};
								i_obj.topic="hostmessage";
								i_obj.type="MESSAGE";
								i_obj.name=i_name;
								i_obj.amount=i_amount;
								lioranboardclient.send(JSON.stringify(i_obj));
							}

						}else{
							var i_obj={};
							i_obj.emotes=i_emote;
							i_obj.login=i_real_name;
							i_obj.display_name=i_name;
							i_obj.color=i_color;
							i_obj.badge=i_badge;
							i_obj.message=i_str;
							i_obj.channel=i_channel
							i_obj.topic="chatmessage"
							i_obj.type="MESSAGE"
							lioranboardclient.send(JSON.stringify(i_obj));
						}
					}break
					
					case "WHISPER":{
						//get display name
						i_name=IRCdataparse(i_data,"display-name");
						//get color
						i_color=IRCdataparse(i_data,"color");
						//get Emote
						i_emote=IRCdataparse(i_data,"emotes");
						//badges
						i_badge=IRCdataparse(i_data,"badges");
						//get user name
						i_pos=i_real_name.indexOf("!");
						i_real_name=i_real_name.slice(0,i_pos);
						
						var i_obj={};
						i_obj.emotes=i_emote;
						i_obj.login=i_real_name;
						i_obj.display_name=i_name;
						i_obj.color=i_color;
						i_obj.badge=i_badge;
						i_obj.message=i_str;
						i_obj.channel="w"
						i_obj.topic="chatmessage"
						i_obj.type="MESSAGE"
						lioranboardclient.send(JSON.stringify(i_obj));
					}break
				
				}
			}
		}
	};
	TwitchChatConnect.onclose = function(event) {
	
		if (on_server==1){
			ConnectionStatus ("tochat","disconnected","Disconnected. Attempting to reconnect in "+(twitch_timeout/1000)+" s.")
			console.log("Disconnected from twitch chat. Attempting to reconnect in "+(twitch_timeout/1000)+" seconds.")
			twitchreconnecting = setTimeout(connecttwitchchat,twitch_timeout);
			twitch_timeout*=2
			if (twitch_timeout>=300000){twitch_timeout=300000}
		}else{
			ConnectionStatus ("tochat","disconnected","Disconnected.")
			console.log("Disconnected from twitch chat.");
		}
		clearInterval(twitchpingid);
	};
}

//parse through irc messages
function IRCdataparse(str,parse){
	var i_pos;
	i_pos=str.indexOf(parse+"=");
	if (i_pos==-1){
		return "";
	}
	str=str.slice(i_pos+1+parse.length);
	i_pos=str.indexOf(";");
	if (i_pos!=-1){
		str=str.slice(0,i_pos);
	}
	return str;
	
}

//receive message from pubsub
function servermessage(){
		//console.log("Pubsub message received.")	
		if (typeof(event.data) == "string"){
			//console.log("Transmiting the message to Lioranboard")
			//console.log(event.data)
			lioranboardclient.send(event.data);
		}else{
			//console.log("Message received from PubSub is not a string")
		}
}
//check twitch api to get informations such as oauth token
function apiconnect(){
	//get information about OAuth token
	function reqListener () {
		//console.log(this.responseText)
		lioranboardclient.send("tokeninfo:"+this.responseText);
	}
	var oReq = new XMLHttpRequest();
	oReq.addEventListener("load", reqListener);
	oReq.open("GET", "https://id.twitch.tv/oauth2/validate",true);
	oReq.setRequestHeader("Authorization", "OAuth "+api_request);
	oReq.send();
	//get information about the user
	function reqListener2 () {
		//console.log(this.responseText)
		lioranboardclient.send("userinfo:"+this.responseText);
	}
	var oReq2 = new XMLHttpRequest();
	oReq2.addEventListener("load", reqListener2);
	oReq2.open("PUT", "https://api.twitch.tv/helix/users",true);
	oReq2.setRequestHeader("Authorization", "Bearer "+api_request);
	oReq2.setRequestHeader("Client-ID", TWITCH_CLIENT_ID);
	oReq2.send();
}


/*
START EXTENSION STUFF HERE
Extension are a way to send and receive data from LioranBoard to your own app or code,
Since this is built on JavaScript, you can build your extension in any language you want and have it connect through here.
To Send a message to LioranBoard simply use the function  lioranboardclient.send(JSONstring);
The string is a JSON string created using JSON.stringify();
Here are the possible message you can send to LioranBoard
Set a value
{"type":"MESSAGE","topic":"SetValue","valuename":"string of your choice","value":real or "string"}

Get a Value
{"type":"MESSAGE","topic":"GetValue","valuename":"name of the value","datatype":"string you wish to get back"}
will reply with, through LioranBoardJSON
{"datatype":"string you selected","valuename":"name of the value","value",real or string}

Trigger (value1-3 are just extra value you can pass through for Math: Trigger Pull)
{"type":"MESSAGE","topic":"ExtensionTrigger","trigger":"string of the name of what you wish to trigger","value1":"string","value2":"string","value3":"string"}

Trigger a button ID    , works the same as Trigger: Button command
{"type":"MESSAGE","topic":"ButtonTrigger","buttonid":a button id,"queueable":true/false}

Modify Button ID  , works the same as Modify Button command
{"type":"MESSAGE","topic":"ModifyButton","buttonid":a button id,"red":redvalue,"green":greenvalue,"blue":bluevalue,"text":"new text","picture":"picture name","border":bordersize}

Alert , send the small yellow message at the bottom of lioranboard
{"type":"MESSAGE","topic":"AlertMessage","message":"Whatever string you want to notify the user with"}
*/

//You can receive message from lioranboard using the command "Send to Extension". The data you send is a JSON string. the String will be converted to a JSON object called LioranBoardJSON
//In the JSON you can include any data you want if you use manual extension.
//for any other extension, the datatype will be what's in the extension box,
function LBExtensionReceived(){
	switch (LioranBoardJSON.datatype){
		//datatype you specified.
		//You hooks will be insert here
		/*INSERT PART 3*/
//[Change Twitch Status hook]
//Change Title or game hook
case "ChangeStream":{
	LBChangeStream(LioranBoardJSON.oauth_token,LioranBoardJSON.channel_id,LioranBoardJSON.title,LioranBoardJSON.game)
}break

//[Change Twitch Status hook end]
//[Viewer Count hook]
case "GetViewerCount":{
	LBGetViewCount(LioranBoardJSON.channel_id,LioranBoardJSON.value_name)
}break

//[Viewer Count hook end]
//[Subscriber Count hook]
//bits leader board hook
case "GetSubscriberCount":{
	LBGetSubCount(LioranBoardJSON.oauth_token,LioranBoardJSON.channel_id,LioranBoardJSON.value_name)
}break

//[Subscriber Count hook end]
//[Get Channel ID hook]
case "GetChannelId":{
	GetChannelId(LioranBoardJSON.oauth_token,LioranBoardJSON.name,LioranBoardJSON.Variable);
}break
//[Get Channel ID hook end]
//[Follower Alert hook]
//Follower alert hook
case "FollowerAlert":{
	lioranboardclient.send('{"type":"MESSAGE","topic":"AlertMessage","message":"Listening for Followers."}')
	//cancel previous interval incase it is set again
	CheckFollowerFirst=0;
	CheckFollowerList=new Array();
	if (typeof CheckFollowerTimer !== 'undefined') {clearInterval(CheckFollowerTimer) }
	CheckFollowerId=LioranBoardJSON.channel_id;
	LBCheckFollowers();
	//set a repeat so this happens every 10 second so you can compare old list and new list
	CheckFollowerTimer = setInterval(LBCheckFollowers,10000);
}break

//[Follower Alert hook end]
//[Bits Leaderboard hook]
//bits leader board hook
case "CheckLeaderboard":{
	LBCheckBitsLeaderboard(LioranBoardJSON.oauth_token)
}break

//[Bits Leaderboard hook end]

		
	}
}

//your script will be inserted here
/*INSERT PART 4*/
//[Change Twitch Status script]
//change stream title or game script
function LBChangeStream(oauthtoken,channel_id,title,game){
	var change_stream={};
	change_stream.channel={};
	//add title change if not empty string
	if (title!==""){
		change_stream.channel.status=title;
	}
	//add game change if not empty string
	if (game!==""){
		change_stream.channel.game=game;
	}
	//send request to twitch
	change_stream=JSON.stringify(change_stream)
	var LBChangeStreamCheck = new XMLHttpRequest();
	LBChangeStreamCheck.open("PUT", "https://api.twitch.tv/kraken/channels/"+channel_id);
	LBChangeStreamCheck.setRequestHeader("Accept", "application/vnd.twitchtv.v5+json");
	LBChangeStreamCheck.setRequestHeader("Content-Type", "application/json");
	LBChangeStreamCheck.setRequestHeader("Authorization", "OAuth "+oauthtoken);
	LBChangeStreamCheck.setRequestHeader("Client-ID", TWITCH_CLIENT_ID);
	LBChangeStreamCheck.send(change_stream);
	lioranboardclient.send('{"type":"MESSAGE","topic":"AlertMessage","message":"Stream Status should have changed."}')
	return 1;
}

//[Change Twitch Status script end]
//[Viewer Count script]

function LBGetViewCount(channelid,valuename){
	//listening for twitch reply
	function GetViewCountListener () {
		var GetViewCountJSON = JSON.parse(this.responseText);
		var i_v=-1;
		if (GetViewCountJSON.stream!=null){i_v=GetViewCountJSON.stream.viewers;}
		//set values for all the relevant info
		lioranboardclient.send('{"type":"MESSAGE","topic":"SetValue","valuename":"'+valuename+'","value":'+i_v+'}')
	}
	var GetViewCountCheck = new XMLHttpRequest();
	GetViewCountCheck.addEventListener("load", GetViewCountListener);
	GetViewCountCheck.open("GET", "https://api.twitch.tv/kraken/streams/"+channelid);
	GetViewCountCheck.setRequestHeader("Accept", "application/vnd.twitchtv.v5+json");
	GetViewCountCheck.setRequestHeader("Client-ID", TWITCH_CLIENT_ID);
	GetViewCountCheck.send();
	return 1;
}
//[Viewer Count script end]
//[Subscriber Count script]
//Bits Leaderboard fetch script
function LBGetSubCount(oauthtoken,channelid,valuename){
	//listening for twitch reply
	function GetSubCountListener () {
		var GetSubCountJSON = JSON.parse(this.responseText);
		//set values for all the relevant info
		lioranboardclient.send('{"type":"MESSAGE","topic":"SetValue","valuename":"'+valuename+'","value":'+(GetSubCountJSON._total-1)+'}')
	}
	//send request to twitch get the top 3
	var GetSubCountCheck = new XMLHttpRequest();
	GetSubCountCheck.addEventListener("load", GetSubCountListener);
	GetSubCountCheck.open("GET", "https://api.twitch.tv/kraken/channels/"+channelid+"/subscriptions?limit=5");
	GetSubCountCheck.setRequestHeader("Accept", "application/vnd.twitchtv.v5+json");
	GetSubCountCheck.setRequestHeader("Authorization", "OAuth "+oauthtoken);
	GetSubCountCheck.setRequestHeader("Client-ID", TWITCH_CLIENT_ID);
	GetSubCountCheck.send();
	return 1;
}

//[Subscriber Count script end]
//[Get Channel ID script]
//get user display name
function GetChannelId(oauthtoken,loginname,variable){
	var i_v=oauthtoken;
	//listening for twitch reply
	function GetIdResponse() {
		var i_js=JSON.parse(this.responseText);
		var i_name='{"type":"MESSAGE","topic":"SetVariable","variable":"'+variable+'","value":"'+i_js.data[0].id+'"}' ;
		lioranboardclient.send(i_name);
	}
	//send request to twitch get the top 3
	var DisplayNameConnection = new XMLHttpRequest();
	DisplayNameConnection.addEventListener("load", GetIdResponse);
	DisplayNameConnection.open("GET", "https://api.twitch.tv/helix/users?login="+loginname);
	DisplayNameConnection.setRequestHeader("Authorization", "Bearer "+oauthtoken);
	DisplayNameConnection.setRequestHeader("Client-ID", "tpqy40pm79e00s63cqusqepvhwqz1n");
	DisplayNameConnection.send();
	return 1;
}
//[Get Channel ID script end]
//[Follower Alert script]
//Follower alert script
function LBCheckFollowers(){
	//listen for receiving follower list
	function followListener () {
		followerJSON = JSON.parse(this.responseText);
		if (followerJSON._total==0){
			lioranboardclient.send('{"type":"MESSAGE","topic":"AlertMessage","message":"Something wrong with follower listen."}')
			return 0;
		};
		var i_cd = followerJSON._total;
		if (i_cd > (30-CheckFollowerFirst*15)){i_cd=(30-CheckFollowerFirst*15)};
		if (CheckFollowerFirst==0){
			for (var ii=0;ii<i_cd;ii++){
				CheckFollowerList.push(followerJSON.follows[ii].user.name)
			}
		}
		
		
		//go through the list and compare to old one see if there is any new names in the new one
		i_cd--;
		if (typeof oldfollowerJSON !== 'undefined') {
			for (var ii=i_cd;ii>=0;ii--){
				if (oldfollowerJSON.follows.some(item => item.user.name === followerJSON.follows[ii].user.name)==false){
					if (CheckFollowerList.some(item => item === followerJSON.follows[ii].user.name)==false){
						CheckFollowerList.push(followerJSON.follows[ii].user.name)
						//send to lioran board as "Follower Alert" with value1 being the name of the follower. pull 1 is their name  pull 2 is channel id of the personne
						lioranboardclient.send('{"type":"MESSAGE","topic":"ExtensionTrigger","trigger":"Follower Alert","value1":"'+followerJSON.follows[ii].user.name+'","value2":"'+followerJSON.follows[ii].user._id+'","value3":"'+followerJSON.follows[ii].user.display_name+'"}')
					}
				}
			}
		}
		CheckFollowerFirst=1;
		oldfollowerJSON = followerJSON;
		followerJSON = null;
		return 1;
	};
	//send request to twitch for the 13 most request followers
	var FollowCheck = new XMLHttpRequest();
	FollowCheck.addEventListener("load", followListener);
	FollowCheck.open("GET", "https://api.twitch.tv/kraken/channels/"+CheckFollowerId+"/follows?limit="+(30-CheckFollowerFirst*15));
	FollowCheck.setRequestHeader("Accept", "application/vnd.twitchtv.v5+json");
	FollowCheck.setRequestHeader("Client-ID", "tpqy40pm79e00s63cqusqepvhwqz1n");
	FollowCheck.send();
	return 1;
}
function fakefollow(){
	var i_name=fakename();
	lioranboardclient.send('{"type":"MESSAGE","topic":"ExtensionTrigger","trigger":"Follower Alert","value1":"'+i_name.toLowerCase()+'","value2":"123456789","value3":"'+i_name+'"}')

}
//[Follower Alert script end]
//[Bits Leaderboard script]
//Bits Leaderboard fetch script
function LBCheckBitsLeaderboard(oauthtoken){
	//listening for twitch reply
	function BitsLeaderboardListener () {
		BitsLeaderboardJSON = JSON.parse(this.responseText);
		//set values for all the relevant info
		lioranboardclient.send('{"type":"MESSAGE","topic":"SetValue","valuename":"no1_bits","value":"'+BitsLeaderboardJSON.data[0].user_name+'","real":false}')
		lioranboardclient.send('{"type":"MESSAGE","topic":"SetValue","valuename":"no1_bits_score","value":"'+BitsLeaderboardJSON.data[0].score+'","real":true}')
		lioranboardclient.send('{"type":"MESSAGE","topic":"SetValue","valuename":"no2_bits","value":"'+BitsLeaderboardJSON.data[1].user_name+'","real":false}')
		lioranboardclient.send('{"type":"MESSAGE","topic":"SetValue","valuename":"no2_bits_score","value":"'+BitsLeaderboardJSON.data[1].score+'","real":true}')
		lioranboardclient.send('{"type":"MESSAGE","topic":"SetValue","valuename":"no3_bits","value":"'+BitsLeaderboardJSON.data[2].user_name+'","real":false}')
		lioranboardclient.send('{"type":"MESSAGE","topic":"SetValue","valuename":"no3_bits_score","value":"'+BitsLeaderboardJSON.data[2].score+'","real":true}')
		//send an extension trigger "Bits Leaderboard"
		lioranboardclient.send('{"type":"MESSAGE","topic":"ExtensionTrigger","trigger":"Bits Leaderboard","value1":"","value2":"","value3":""}')
	}
	//send request to twitch get the top 3
	var BitsLeaderboardCheck = new XMLHttpRequest();
	BitsLeaderboardCheck.addEventListener("load", BitsLeaderboardListener);
	BitsLeaderboardCheck.open("GET", "https://api.twitch.tv/helix/bits/leaderboard?count=3");
	BitsLeaderboardCheck.setRequestHeader("Authorization", "Bearer "+oauthtoken);
	BitsLeaderboardCheck.setRequestHeader("Client-ID", TWITCH_CLIENT_ID);
	BitsLeaderboardCheck.send();
	return 1;
}

//[Bits Leaderboard script end]



        </script>

    </body>
<<<<<<< HEAD
</html>
=======
</html>
>>>>>>> 88db161bb368ed64c4fdea269d06a054957dc1cf
