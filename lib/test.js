const DiscTwitchRelay={settings:void 0,socket:void 0,heartbeat:5e3,session_id:void 0,seq:void 0,callbacks:{},next_callbacks:{},emit:function(e,t){null!=this.callbacks[e]&&this.callbacks[e].forEach(function(e){e(t)}),null!=this.next_callbacks[e]&&(this.next_callbacks[e].forEach(function(e){e(t)}),delete this.next_callbacks[e])},on:function(e,t){null==this.callbacks[e]&&(this.callbacks[e]=[]),this.callbacks[e].push(t)},next:function(e,t){null==this.next_callbacks[e]&&(this.next_callbacks[e]=[]),this.next_callbacks[e].push(t)},gateway:void 0,calls:{},chunks:function*(e,t){for(let o=0;o<e.length;o+=t)yield e.slice(o,o+t)},LBAlert:function(e){lioranboardclient.send('{"type":"MESSAGE","topic":"AlertMessage","message":"'+e+'"}')},fetchDiscordRelay:async function(e,t,o){let s={method:t,headers:{"Content-Type":"application/json"}};o&&(s.body=JSON.stringify(o));const n=await fetch(e,s);let c;if(!n.ok){let e=await n.json(),t=e.message||e.error||"Something went wrong.";throw new Error(t)}try{c=await n.json()}catch(e){}return c},Chatters:async e=>{let t=JSON.parse(sessionStorage.getItem("chatters"))||[];await fetch("https://cors.bridged.cc/https://tmi.twitch.tv/group/user/"+e+"/chatters").then(e=>e.json()).then(e=>{const{broadcaster:o,moderators:s,viewers:n,vips:c}=e.chatters;let i=[...s,...n,...c];if(0==i.length)return void DiscTwitchRelay.LBAlert("Discord Relay error: Wrong channel name. No chatters found.");o[0]&&i.push(o[0]);let a=t;t=[],i.forEach(function(e){a.includes(e)||t.push(e)}),Array.prototype.unique=function(){for(var e=this.concat(),t=0;t<e.length;++t)for(var o=t+1;o<e.length;++o)e[t]===e[o]&&e.splice(o--,1);return e},sessionStorage.setItem("chatters",JSON.stringify(i.concat(a).unique()))}).catch(e=>{console.log(e)}),[...DiscTwitchRelay.chunks(t,100)].forEach(async function(e){let t=e.join("&login=");await fetch("https://api.twitch.tv/helix/users?login="+t,{headers:{"Client-ID":TWITCH_CLIENT_ID,Authorization:"Bearer "+DiscTwitchRelay.settings.oauthtoken,"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{e.data.forEach(function(e){let t=e.profile_image_url||e.offline_image_url;sessionStorage.setItem(e.login+"_url",t)})}).catch(e=>console.log(e))}),TWCRelay.timeout=setTimeout(DiscTwitchRelay.Chatters,6e4,e)},TwitchWebhook:function(){let e=this.settings;if(0!=e.array.length){let t=e.array;this.settings.array=[];let o=[],s=" ";if("pretty"==e.mode&&t.length<11)for(let e=0;e<t.length;e++){let s=t[e].user_type+" "||"";console.log(t[e]);let n=sessionStorage.getItem(t[e].username.toLowerCase()+"_url")||"https://static-cdn.jtvnw.net/user-default-pictures-uv/13e5fa74-defa-11e9-809c-784f43822e80-profile_image-70x70.png";o.push({author:{name:s+t[e].username,url:"https://twitch.tv/"+t[e].username,icon_url:n},description:t[e].text,color:this.convertColor(t[e].color)})}else for(let e=0;e<t.length;e++)s=s+"_ _ \n**"+t[e].username+"**\n"+t[e].text,o=void 0;let n={content:s,username:"Twitch Chat"};o&&(n.embeds=o),DiscTwitchRelay.fetchDiscordRelay(e.webhook,"POST",n).catch(e=>DiscTwitchRelay.LBAlert("Discord Relay webhook: "+e))}},convertColor:function(e){let t,o,s=[];if(-1!=e.search("#")&&(e=e.substr(1)),3===e.length)for(t=e.split(""),o=0;o<3;o++)s.push(parseInt(t[o]+""+t[o],16));else if(6===e.length)for(t=e.match(/.{2}/g),o=0;o<3;o++)s.push(parseInt(t[o],16));s[2],s[1],s[0];return s[2]+(s[1]<<8)+(s[0]<<16)},connect:async function(e){let t=this.settings,o="wss://gateway.discord.gg?v=8&encoding=json";const s=this;await fetch("https://discord.com/api/gateway","GET").then(e=>o=e.url+"?v=8&encoding=json").catch(e=>{});try{clearInterval(s.ping)}catch(e){}s.gateway=o,s.socket=new WebSocket(o),s.socket.onopen=function(e){s.emit("open","Connection established!")},s.socket.onmessage=function(o){console.log(o);let n=o.data;if("string"==typeof o.data&&(n=JSON.parse(o.data)),"READY"==n.t&&(s.emit("DiscordSuccess",o),s.session_id=n.d.session_id,s.reconnecting?(s.reconnecting=!1,s.emit("reconnected")):s.emit("ready")),null!=n.s&&(s.seq=n.s),null!=n.op&&10==n.op?(s.heartbeat=n.d.heartbeat_interval,s.ping=setInterval(function(){null!=s.socket&&1===s.socket.readyState?s.socket.send(JSON.stringify({op:1,d:null})):clearInterval(s.ping)},s.heartbeat),e?s.socket.send(JSON.stringify({op:6,d:{token:s.settings.token,session_id:s.session_id,seq:s.seq}})):s.socket.send(JSON.stringify({op:2,d:{token:t.token,intents:640,large_threshold:100,properties:{os:t.os||"windows",browser:t.device||"LBTwitch",device:t.device||"LBTwitch",referrer:"",referring_domain:""}}}))):n.op,0==n.op){var c=n.t,i=n.d;s.emit(c,i),"MESSAGE_CREATE"==c?s.emit("message",i):"GUILD_MEMBER_REMOVE"==c?s.emit("member_remove",i):"GUILD_MEMBER_ADD"==c?s.emit("member_add",i):"MESSAGE_UPDATE"==c&&s.emit("edited",i)}7==n.op&&s.close(!0,!0),9==n.op&&s.close(!0),n.op},s.socket.onerror=function(e){s.socket.readyState==s.socket.CLOSED&&s.close(!0),s.emit("socketError",e.reason)},s.socket.onclose=function(e){4004!==e.code&&s.close(!0),s.emit("socketClosedError",e.reason)}},reconnecting:!1,close:function(e,t){const o=this;o.timeoutconnect&&clearTimeout(o.timeoutconnect),o.ping&&clearInterval(o.ping),o.socket.onclose=void 0,o.socket.onerror=void 0,o.socket=void 0,e&&(o.timeoutconnect=setTimeout(()=>{o.connect(t)},3e3)),o.emit("closed")},send:function(e){p.socket.send(JSON.stringify(e))}};