function ChattyKathy(a,b,c,d,e,f){function g(a,b){if(0!==e&&parseInt(e)!==NaN){let b={type:"MESSAGE",topic:"ModifyButton",red:"",green:"",blue:"",picture:"",border:""};message_button=h(a,f),b.text=message_button,b.buttonid=parseInt(e),lioranboardclient.send(JSON.stringify(b))}return new Promise(function(c){t=!0,j(a,b).then(n).then(c)})}function h(a,b){let c=new RegExp(".{1,"+b+"}(\\s|$)","g"),d=a.match(c);return d.join("\n")}function i(){let a=u.playlist;if(0<a.length){let b=a[0],c=a[1];a.splice(0,2),g(b,c).then(i)}}async function j(a,b){let c=await m(a,b);return null===c||"undefined"==typeof audioStream?k(a,b):JSON.parse(audioStream.AudioStream).data}function k(a,b){return new Promise(function(c,e){const f=new AWS.Polly,g={OutputFormat:"mp3",Text:`<speak>${a}</speak>`,VoiceId:b.pollyVoiceId,TextType:"ssml",Engine:b.pollyVoiceEngine||d};f.synthesizeSpeech(g,function(d,f){d?e(d):(l(a,f.AudioStream,b),c(f.AudioStream))})})}function l(a,b,c){const d={Message:a,AudioStream:JSON.stringify(b),settings:c};var e=JSON.parse(localStorage.getItem("chattyKathyDictionary"));null===e?(e=[],e.push(d)):e.push(d);try{localStorage.setItem("chattyKathyDictionary",JSON.stringify(e))}catch(a){localStorage.removeItem("chattyKathyDictionary")}}async function m(a,b){let c=localStorage.getItem("chattyKathyDictionary");if(null===c)return null;let d=JSON.parse(c),e=d.filter(function(b){return b.Message===a});e=e.filter(function(a){return a.settings.pollyVoiceId==b.pollyVoiceId})[0]}function n(a){return new Promise(function(b){const c=new Uint8Array(a),d=c.buffer,e=new Blob([d]),f=URL.createObjectURL(e);p.src=f,q=function(){p.removeEventListener("ended",q,!1),t=!1,b()},p.addEventListener("ended",q,!1);let g=p.play();g!==void 0&&g.then(()=>{}).catch(()=>{console.log,i()})})}function o(a){return"undefined"==typeof a&&lioranboardclient.send("{\"type\":\"MESSAGE\",\"topic\":\"AlertMessage\",\"message\":\"TTS Polly Error: AWS Credentials are missing.\"}"),("undefined"==typeof a.pollyVoiceId||"default"==a.pollyVoiceId)&&(a.pollyVoiceId=c,a.engine=d),"undefined"!=typeof a.cacheSpeech||!0!==a.cacheSpeech,a}const p=document.createElement("audio");p.setAttribute("id","PollyAudio"),document.body.appendChild(p);var q,r;let s=2;Number.isInteger(parseInt(f))||(f=100);try{r=JSON.parse(localStorage.getItem("PollyPrevious")),null===r&&(r=[])}catch(a){r=[]}let t=!1;("undefined"==typeof a||0==a)&&lioranboardclient.send("{\"type\":\"MESSAGE\",\"topic\":\"AlertMessage\",\"message\":\"TTS Polly Error: Initiate the extension first with valid credentials.\"}"),AWS.config.credentials=a,AWS.config.region=b;const u={self:this,playlist:[],Speak:function(a,b){s=2,r.push(a,b);try{localStorage.setItem("PollyPrevious",JSON.stringify(r))}catch(a){localStorage.removeItem("PollyPrevious")}b=o(b),t?this.playlist.push(a,b):g(a,b).then(i)},Skip:function(){t=!0,i()},Play:function(){p.play(),t=!0},Pause:function(){let a=p.play();a!==void 0&&a.then(()=>{p.pause(),t=!1}).catch(()=>{})},Mute_unmute:function(){p.muted=!p.muted},VolumeUp:function(a){p.volume+=a/100},VolumeDown:function(a){p.volume-=a/100},Duration:function(){console.log(p.duration)},Skip_forward:function(a){p.currentTime+=parseInt(a)},Skip_backwards:function(a){p.currentTime-=parseInt(a)},Previous:function(){p.removeEventListener("ended",q,!1);let a=u.playlist;2>s&&(s=2),s>r.length&&(s=r.length),s+=2,0<a.length&&(s=a.length+2+2),0<r.length&&g(r[r.length-s],r[r.length-s+1]).then(i)},Next:function(){p.removeEventListener("ended",q,!1);let a=u.playlist;console.log(a),t=!0,0<a.length?i():(s>=r.length&&(s=r.length),s-=2,2>s&&(s=2),0<r.length&&g(r[r.length-s],r[r.length-s+1]))},SpeakWithPromise:function(a){return g(a)},IsSpeaking:function(){return t},Clear_playlist:function(){localStorage.removeItem("chattyKathyDictionary"),localStorage.removeItem("PollyPrevious"),r=[]}};return u}