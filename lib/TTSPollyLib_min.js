function TTSPollyLib(e,t,n,o,i,l){const r={pollyVoiceId:n,cacheSpeech:!0,pollyVoiceEngine:o,pitch:"",speed:"",effect:'name="null"'},c=document.createElement("audio");let s;c.setAttribute("id","PollyAudio"),document.body.appendChild(c),c.muted=!1,Number.isInteger(parseInt(l))||(l=100);try{null===(s=JSON.parse(localStorage.getItem("PollyPrevious")))&&(s=[])}catch(e){s=[]}current_id=s.length-1;let u=!1;AWS.config.credentials=e,AWS.config.region=t;const a={self:this,playlist:[],Speak:function(e,t){console.log("function speak "+u);let n={msg:e,settings:t=function(e){void 0===e?e=r:void 0===e.pollyVoiceId||"default"==e.pollyVoiceId?e=r:(e.speed=void 0!==e.speed?`rate="${e.speed}"`:"",e.pitch="neural"!==e.pollyVoiceEngine&&void 0!==e.pitch?`pitch="${e.pitch}"`:"","neural"!==e.pollyVoiceEngine&&"none"!==e.effect?"soft"==e.effect?e.effect='phonation="soft"':e.effect=`name="${e.effect}"`:e.effect='name="null"');return e}(t)};s.push(n);try{localStorage.setItem("PollyPrevious",JSON.stringify(s))}catch(e){console.log("Speak function: "+e),localStorage.removeItem("PollyPrevious")}u?this.playlist.push(e,t):d(e,t).then(p)},Play:function(){if(console.log("pause "+c.paused),c.paused){let e=c.play();console.log("function speak promise "+iplayPromise),void 0!==e&&(u=!0,c.addEventListener("ended",handler,!1),e.catch(e=>{}))}else p()},Pause:function(){c.replaceWith(c.cloneNode(!0));let e=c.play();void 0!==e&&e.then(e=>{c.pause(),u=!1}).catch(e=>{})},Mute_unmute:function(){c.muted=!c.muted},VolumeUp:function(e){let t=c.volume+e/100;c.volume=t<=1?t:1},VolumeDown:function(e){let t=c.volume-e/100;c.volume=t>=0?t:0},Skip_forward:function(e){c.currentTime=c.currentTime+parseInt(e)},Skip_backwards:function(e){c.currentTime=c.currentTime-parseInt(e)},Previous:function(){c.replaceWith(c.cloneNode(!0)),c.removeEventListener("ended",handler,!1),current_id=current_id>0?current_id-1:0,console.log("Previousfunction: "+s),d(s[current_id].msg,s[current_id].settings,1).then(p)},Next:function(){c.replaceWith(c.cloneNode(!0)),c.removeEventListener("ended",handler,!1);let e=a.playlist;console.log("function next list length"+e.length),e.length>0?p():(current_id=current_id<s.length-1?current_id+1:s.length-1,d(s[current_id].msg,s[current_id].settings).then(p))},SpeakWithPromise:function(e){return console.log("SpeakWithPromise: "+e),d(e)},IsSpeaking:function(){return u},Clear_playlist:function(){localStorage.removeItem("pollydictionary"),localStorage.removeItem("PollyPrevious"),s=[],current_id=0,location.reload()}};function d(e,t,n=0){if(current_id=0==n?current_id+1:current_id,console.log("function say current id "+current_id+" message "+e),0!==i&&NaN!==parseInt(i)){let t={type:"MESSAGE",topic:"ModifyButton",red:"",green:"",blue:"",picture:"",border:""};message_button=function(e,t){let n=new RegExp(".{1,"+t+"}(\\s|$)","g");return e.match(n).join("\n")}(e,l),t.text=message_button,t.buttonid=parseInt(i),lioranboardclient.send(JSON.stringify(t))}return new Promise(function(n,i){u=!0,async function(e,t){let n=await async function(e,t){let n=localStorage.getItem("pollydictionary");if(null===n)return null;JSON.parse(n).filter(function(n){return n.Message===e&&n.settings.pollyVoiceId==t.pollyVoiceId&&n.settings.effect==t.effect&&n.settings.pitch==t.pitch&&n.settings.speed==t.speed&&n.settings.pollyVoiceEngine==t.pollyVoiceEngine})[0]}(e,t);return console.log("function get audio "+n),null===n||"undefined"==typeof audioStream?function(e,t){return console.log("Requested speech from AWS "+e),new Promise(function(n,i){const l=new AWS.Polly,r={OutputFormat:"mp3",Text:`<speak><prosody ${t.speed} ${t.pitch}><amazon:effect ${t.effect}>${e}</amazon:effect></prosody></speak>`,VoiceId:t.pollyVoiceId,TextType:"ssml",Engine:t.pollyVoiceEngine||o};l.synthesizeSpeech(r,function(o,i){if(o){let e="TTS Polly Error: "+(o=JSON.parse(JSON.stringify(o))).code||"TTS Polly Error: Something went wrong. Check your credentials.";403==o.statusCode&&(window.PollyTTS=void 0),f(e)}else!function(e,t,n){const o={Message:e,AudioStream:JSON.stringify(t),settings:n};var i=JSON.parse(localStorage.getItem("pollydictionary"));null===i?(i=[]).push(o):i.push(o);try{localStorage.setItem("pollydictionary",JSON.stringify(i))}catch(e){localStorage.removeItem("pollydictionary")}}(e,i.AudioStream,t),n(i.AudioStream)})})}(e,t):JSON.parse(audioStream.AudioStream).data}(e,t).then(g).then(n)})}function p(){let e=a.playlist;if(console.log("function say next "+e[0]),e.length>0){let t=e[0],n=e[1];current_id=s.length-1-(e.length-2)/2,console.log(current_id),e.splice(0,2),d(t,n,1).then(p)}}function f(e){lioranboardclient.send('{"type":"MESSAGE","topic":"AlertMessage","message":"'+e+'"}')}function g(e){return new Promise(function(t,n){const o=new Uint8Array(e).buffer,i=new Blob([o]),l=URL.createObjectURL(i);c.src=l,c.addEventListener("ended",handler,!1);let r=c.play();console.log("function playAudio promise "+typeof r+" "+c),void 0!==r&&r.then(e=>{}).catch(e=>{console.log(e),f("TTS Polly Error: Click on 'Activate' button in your Transmitter first.")})})}return handler=function(){c.replaceWith(c.cloneNode(!0)),c.removeEventListener("ended",handler,!1),u=!1,p()},a}