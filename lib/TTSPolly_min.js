function TTSPollyLib(e,t,n,o,i,r){const l={pollyVoiceId:n,cacheSpeech:!0,pollyVoiceEngine:o,pitch:"",speed:"",effect:'name="null"'},c=document.createElement("audio");let s,u,a;c.setAttribute("id","PollyAudio"),document.body.appendChild(c),c.muted=!1,Number.isInteger(parseInt(r))||(r=100);try{a=JSON.parse(localStorage.getItem("PollyPrevious")),u=Object.keys(a).length||0,null===a&&(a=[])}catch(e){a={},u=0}current_id=u;let d=!1;AWS.config.credentials=e,AWS.config.region=t;const f={self:this,playlist:[],Speak:function(e,t){let n={msg:e,settings:t=function(e){void 0===e?e=l:void 0===e.pollyVoiceId||"default"==e.pollyVoiceId?e=l:(e.speed=void 0!==e.speed?`rate="${e.speed}"`:"",e.pitch="neural"!==e.pollyVoiceEngine&&void 0!==e.pitch?`pitch="${e.pitch}"`:"","neural"!==e.pollyVoiceEngine&&"none"!==e.effect||void 0!==typeof e.effect||"drc"==e.effect?"soft"==e.effect?e.effect='phonation="soft"':e.effect=`name="${e.effect}"`:e.effect='name="null"');return e}(t)};a[++u]=n;try{localStorage.setItem("PollyPrevious",JSON.stringify(a))}catch(e){localStorage.removeItem("PollyPrevious")}d?this.playlist.push(e,t):p(e,t).then(y)},Play:function(){c.play(),d=!0},Pause:function(){let e=c.play();void 0!==e&&e.then(e=>{c.pause(),d=!1}).catch(e=>{})},Mute_unmute:function(){c.muted=!c.muted},VolumeUp:function(e){let t=c.volume+e/100;c.volume=t<=1?t:1},VolumeDown:function(e){let t=c.volume-e/100;c.volume=t>=0?t:0},Skip_forward:function(e){c.currentTime=c.currentTime+parseInt(e)},Skip_backwards:function(e){c.currentTime=c.currentTime-parseInt(e)},Previous:function(){c.removeEventListener("ended",s,!1),d=!0,current_id=current_id>1?current_id-1:1,p(a[current_id].msg,a[current_id].settings,1).then(y)},Next:function(){c.removeEventListener("ended",s,!1),f.playlist.length>0?y():(current_id=current_id<Object.keys(a).length?current_id+1:Object.keys(a).length,p(a[current_id].msg,a[current_id].settings).then(y))},SpeakWithPromise:function(e){return p(e)},IsSpeaking:function(){return d},Clear_playlist:function(){localStorage.removeItem("pollydictionary"),localStorage.removeItem("PollyPrevious"),a={}}};function p(e,t,n=0){if(current_id=0==n?current_id+1:current_id,0!==i&&NaN!==parseInt(i)){let t={type:"MESSAGE",topic:"ModifyButton",red:"",green:"",blue:"",picture:"",border:""};message_button=function(e,t){let n=new RegExp(".{1,"+t+"}(\\s|$)","g");return e.match(n).join("\n")}(e,r),t.text=message_button,t.buttonid=parseInt(i),lioranboardclient.send(JSON.stringify(t))}return new Promise(function(n,i){d=!0,async function(e,t){return null===await async function(e,t){let n=localStorage.getItem("pollydictionary");if(null===n)return null;JSON.parse(n).filter(function(n){return n.Message===e&&n.settings.pollyVoiceId==t.pollyVoiceId&&n.settings.effect==t.effect&&n.settings.pitch==t.pitch&&n.settings.speed==t.speed&&n.settings.pollyVoiceEngine==t.pollyVoiceEngine})[0]}(e,t)||"undefined"==typeof audioStream?function(e,t){return new Promise(function(n,i){const r=new AWS.Polly,l={OutputFormat:"mp3",Text:`<speak><prosody ${t.speed} ${t.pitch}><amazon:effect ${t.effect}>${e}</amazon:effect></prosody></speak>`,VoiceId:t.pollyVoiceId,TextType:"ssml",Engine:t.pollyVoiceEngine||o};r.synthesizeSpeech(l,function(o,i){if(o){console.log(JSON.parse(JSON.stringify(o)));let e="TTS Polly Error: "+JSON.parse(JSON.stringify(o)).code||"TTS Polly Error: Something went wrong. Check your credentials.";g(e),window.PollyTTS=void 0}else!function(e,t,n){const o={Message:e,AudioStream:JSON.stringify(t),settings:n};var i=JSON.parse(localStorage.getItem("pollydictionary"));null===i?(i=[]).push(o):i.push(o);try{localStorage.setItem("pollydictionary",JSON.stringify(i))}catch(e){localStorage.removeItem("pollydictionary")}}(e,i.AudioStream,t),n(i.AudioStream)})})}(e,t):JSON.parse(audioStream.AudioStream).data}(e,t).then(m).then(n)})}function y(){let e=f.playlist;if(e.length>0){let t=e[0],n=e[1];current_id=Object.keys(a).length-(e.length-2)/2,e.splice(0,2),p(t,n,1).then(y)}}function g(e){lioranboardclient.send('{"type":"MESSAGE","topic":"AlertMessage","message":"'+e+'"}')}function m(e){return new Promise(function(t,n){const o=new Uint8Array(e).buffer,i=new Blob([o]),r=URL.createObjectURL(i);c.src=r,s=function(){c.removeEventListener("ended",s,!1),d=!1,t()},c.addEventListener("ended",s,!1);let l=c.play();void 0!==l&&l.then(e=>{}).catch(e=>{g("TTS Polly Error: Click on 'Activate' button in your Transmitter first."),d=!1})})}return f}